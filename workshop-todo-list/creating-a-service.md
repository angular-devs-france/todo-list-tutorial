# #15: üîãCr√©er un service

Dans Angular, un service est une classe JavaScript qui est responsable d'effectuer une t√¢che sp√©cifique n√©cessaire √† votre application. Dans notre application todo-list, nous allons cr√©er un service qui sera responsable de l'enregistrement et de la gestion de toutes les t√¢ches, et nous l'utiliserons en l'injectant dans les composants.

## Cr√©er un service avec Angular CLI:

```
ng g s services/todo-list
```
`s` est le raccourci de... vous l'avez devin√© - service.
Cette commande va g√©n√©rer le service `TodoListService` dans le fichier `src/app/services/todo-list.service.ts`. Il a le d√©corateur `@Injectable` qui lui permet d'utiliser l'injection de d√©pendance.

{% code title="src/app/services/todo-list.service.ts" %}
```
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class TodoListService {

  constructor() { }
}
```
{% endcode %}

## Partager des donn√©es

Maintenant nous pouvons d√©placer le tableau `todoList` du composant `list-manager` vers notre nouveau service. 
Allez dans le fichier `src/app/services/todo-list.service.ts`, et ajoutez ce code √† l'int√©rieur de la classe `TodoListService` juste au-dessus du `constructor` :

{% code title="src/app/services/todo-list.service.ts" %}
```typescript
private todoList: TodoItem[] = [
  {title: 'install NodeJS'},
  {title: 'install Angular CLI'},
  {title: 'create new app'},
  {title: 'serve app'},
  {title: 'develop app'},
  {title: 'deploy app'},
];
```
{% endcode %}

Assurez-vous que l'interface TodoItem est bien import√©e :

{% code title="src/app/services/todo-list.service.ts" %}
```typescript
import { TodoItem } from '../interfaces/todo-item';
```
{% endcode %}

## Cr√©er une m√©thode pour retourner la liste

Nous allons ajouter une m√©thode `getTodoList` qui va retourner le tableau `todoList`. Le service ressemblera √† ceci:

{% code title="src/app/services/todo-list.service.ts" %}
```typescript
import { Injectable } from '@angular/core';
import { TodoItem } from '../interfaces/todo-item';

@Injectable({
  providedIn: 'root'
})
export class TodoListService {

  private todoList: TodoItem[] = [
    {title: 'install NodeJS'},
    {title: 'install Angular CLI'},
    {title: 'create new app'},
    {title: 'serve app'},
    {title: 'develop app'},
    {title: 'deploy app'},
  ];

  constructor() { }

  getTodoList(): TodoItem[] {
    return this.todoList;
  }
}
```
{% endcode %}

## Injecter et utiliser le service

Apr√®s avoir cr√©√© le service, nous pouvons l'injecter dans notre composant `list-manager`. Dans Angular, l'injection de d√©pendance est tr√®s simple. Nous le passons en param√®tre dans le constructeur - le type de param√®tre est le nom de la classe du service. Angular attribue l'instance qu'il a cr√©√©e au nom du param√®tre, et nous pouvons l'utiliser √† partir du constructeur. Avant de l'impl√©menter nous-m√™mes, voyons comment cela fonctionne. Voici le constructeur de la classe `ListManagerComponent`:

{% code title="src/app/list-manager/list-manager.component.ts" %}
```typescript
constructor(todoListService: TodoListService) {
  todoListService.getTodoList();
}
```
{% endcode %}

Typescript nous aide en nous donnant un raccourci pour assigner le param√®tre √† un membre de classe. En ajoutant `private` ou `public` avant le nom du param√®tre, il est automatiquement assign√© √† `this`. Donc au lieu de d√©clarer et d'assigner la propri√©t√© par nous-m√™mes :

```typescript
export class ListManagerComponent {
  todoListService: TodoListService;

  constructor(todoListService: TodoListService) { 
    this.todoListService = todoListService;
  }
}
```

... nous pouvons r√©duire beaucoup de code comme ceci:

```typescript
export class ListManagerComponent {

  constructor(private todoListService: TodoListService) { }
}
```

Utilisons le service dans le composant `list-manager`.

* Supprimez la liste cod√©e en dur du composant, ne gardez que la d√©claration de la propri√©t√© `todoList` avec son type.
* Injectez le `TodoListService` par le constructeur.

{% code title="src/app/list-manager/list-manager.component.ts" %}

```typescript
export class ListManagerComponent {
  todoList: TodoItem[];

  constructor(private todoListService: TodoListService) { }
```

* Assurez-vous que le `TodoListService` est bien import√©.

{% code title="src/app/list-manager/list-manager.component.ts" %}
```typescript
import { TodoListService } from '../services/todo-list.service';
```
{% endcode %}

* R√©cup√©rez la liste du service dans le `constructor` et l'assigner √† notre propri√©t√©.

{% code title="src/app/list-manager/list-manager.component.ts" %}
```typescript
constructor(private todoListService: TodoListService) {
  this.todoList = this.todoListService.getTodoList();
}
```
{% endcode %}

Vous n'avez pas besoin de changer quoi que ce soit dans le mod√®le puisque nous assignons la liste √† la m√™me propri√©t√© que nous avons utilis√©e auparavant. Il semble que rien n'ait chang√©, mais vous pouvez v√©rifier que la liste provient du service en la changeant √† partir de l√† (ajout d'un √©l√©ment, changement de titre, etc.).

Si la liste n'est pas affich√©e et qu'aucune erreur ne se produit lors de la compilation, le projet pourrait ne pas √™tre synchronis√© avec l'ajout du fichier de service. Arr√™tez l'ex√©cution de `ng serve` dans le terminal en cliquant sur `Ctrl+C` et ex√©cutez-le √† nouveau.

{% hint style="info" %}
üíæ **Pusher votre code sur GitHub**

Committez tous vos changements en ex√©cutant cette commande dans votre r√©pertoire de projet.

```bash
git add -A && git commit -m "votre message de commit"
```

Pusher vos changements sur GitHub en ex√©cutant cette commande dans votre r√©pertoire de projet.

```
git push
```
{% endhint %}
